---
description: 确认执行方案并拆分实现步骤
handoffs: 
  - label: 📝 生成任务清单
    agent: k.task
    prompt: 根据计划生成任务清单并执行
---

# 实现计划: [功能名称]

## 用户输入

```text
$ARGUMENTS
```

---

## 核心目的

确认执行方案，将需求转化为可执行的步骤。

---

## 🤝 AI 协作模式

> 💡 **借鉴 Sora 团队经验**：将 AI 视为"高级工程师"，人类专注于"指导和审查"

### 角色定位

```
┌─────────────────────────────────────────────────────────┐
│  👤 人类（你）          │  🤖 AI（我）                   │
├─────────────────────────┼───────────────────────────────┤
│  ✅ 决策者              │  ✅ 执行者                     │
│  ✅ 方案审核            │  ✅ 代码生成                   │
│  ✅ 质量把关            │  ✅ 细节实现                   │
│  ✅ 业务判断            │  ✅ 技术建议                   │
└─────────────────────────┴───────────────────────────────┘
```

### 协作原则

1. **明确指令**：给出清晰的目标和约束，AI 会输出更高质量的结果
2. **分步确认**：复杂任务拆分执行，每步确认后再继续
3. **审查优先**：重点审查 AI 输出的代码逻辑和架构决策
4. **及时纠偏**：发现偏差立即指出，避免错误累积

---

## 执行步骤

### 1. 确认方案

a. 如果已经确认了方案，直接进入步骤拆分
b. 如果有多个方案，分析对比后选择最优方案

### 2. 定位代码位置

a. 根据需求描述（文字/图片）定位相关代码
b. 确认需要修改的文件和位置
c. 分析代码依赖关系

### 3. 拆分执行步骤（必须）

**⚠️ 强制要求：必须使用 `todo_write` 工具生成任务清单**

根据分析结果，拆分为合理的执行步骤，并**立即调用 todo_write 工具**：

```markdown
## 步骤规划

### Step 1: [步骤名称]
- 目标：[该步骤要达成的目标]
- 文件：[涉及的文件路径]
- 操作：[具体操作描述]

### Step 2: [步骤名称]
- 目标：...
- 文件：...
- 操作：...
```

**必须执行**：调用 `todo_write` 工具，将上述步骤写入 todolist，格式示例：
- `Step 1: [步骤名称] - [文件路径]`
- `Step 2: [步骤名称] - [文件路径]`

### 4. 风险评估

- 识别潜在风险点
- 准备回滚方案（如需要）

---

## 完成条件

完成上述所有步骤后：

**1. 确认 todolist 已创建**（如未创建，立即调用 todo_write）

**2. 输出计划摘要**：

```
✅ 计划制定完成

📊 步骤总数：[N] 步
📁 涉及文件：[文件数量] 个
⏱️ 预估复杂度：[低/中/高]
📋 Todolist：已创建
```

---

## 🔄 确认流转

**计划完成后，需要用户确认才能进入任务执行阶段。**

输出确认提示：

```
🔄 是否确认此方案并进入 [任务执行阶段]？

回复 Y 继续执行，或提出修改意见
```

等待用户回复：
- 用户回复 `Y` 或 `是` → 自动执行 `.cursor/commands/k/task.md`
- 用户有其他意见 → 根据反馈调整方案