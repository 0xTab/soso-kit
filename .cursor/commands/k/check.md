---
description: 提交前进行代码检查和验收
---

# 检查清单: [功能名称]

**规范**: `./spec.md` | **日期**: [YYYY-MM-DD] | **状态**: 🔴未开始/🟡进行中/🟢完成

---

## 执行检查

依次检查以下所有项目：

### 需求检查

- [ ] CHK-01 功能需求(MUST)全部满足
- [ ] CHK-02 边界情况已处理
- [ ] CHK-03 没有遗漏的功能点
- [ ] CHK-04 没有逻辑问题

### 技术检查

- [ ] CHK-05 代码符合 `.cursor/rules/` 项目规范
- [ ] CHK-06 代码符合 `regular.mdc` 通用规范（注释中文、简洁格式）
- [ ] CHK-07 无明显性能问题
- [ ] CHK-08 错误处理完善
- [ ] CHK-09 **弹窗/Drawer 状态重置**：打开后是否正确重置状态，不重置是否会导致数据残留问题

### 🔍 AI 生成代码审查（重点）

> 💡 **借鉴 Sora 团队经验**：重点审查 AI 生成的代码，而非逐行编写

- [ ] CHK-11 **逻辑正确性**：AI 生成的业务逻辑是否符合需求意图
- [ ] CHK-12 **边界处理**：空值、异常输入、极端情况是否处理
- [ ] CHK-13 **代码风格**：是否与项目现有代码风格一致
- [ ] CHK-14 **依赖合理**：新增的依赖是否必要且安全
- [ ] CHK-15 **无冗余代码**：是否有 AI 生成的无用代码或注释

### 交付检查

- [ ] CHK-16 文档已更新（如需要）
- [ ] CHK-17 代码已自查
- [ ] CHK-18 可正常运行

---

## 检查结果

完成检查后，输出检查报告：

```markdown
## 📋 检查报告

| 类别 | 通过 | 未通过 | 总计 |
|------|------|--------|------|
| 需求检查 | [N] | [N] | 4 |
| 技术检查 | [N] | [N] | 5 |
| AI代码审查 | [N] | [N] | 5 |
| 交付检查 | [N] | [N] | 3 |
| **总计** | [N] | [N] | 17 |
```

---

## 问题记录

如有问题，记录在此：

| 问题 | 严重度 | 状态 |
|------|--------|------|
| [描述问题] | 🔴高/🟡中/🟢低 | 待处理/已解决 |

---

## 得出结论

### 判断逻辑：

a. 所有检查项通过 → **可以提交**
b. 有未通过项 → 给出理由，**返回修复**

---

## 📑 文档合并（核心步骤）

**⚠️ 强制要求：check 完成后，必须将 spec 和 history 文档合并为一个文档**

### 合并流程

```
┌─────────────┐     ┌─────────────┐
│  spec 目录   │  +  │ history 目录 │
│  (需求文档)  │     │  (历史文档)  │
└──────┬──────┘     └──────┬──────┘
       │                   │
       └─────────┬─────────┘
                 ↓
        ┌───────────────┐
        │  合并为一个文档  │
        │  (以 spec 为主) │
        └───────┬───────┘
                ↓
        ┌───────────────┐
        │ 输出到 history │
        └───────────────┘
```

### 合并原则：spec 完整保留

**⚠️ 核心原则：spec 文档内容必须完整保留，不能移除任何内容**

| 来源 | 处理方式 |
|------|----------|
| **spec** | **完整保留**：核心需求、执行步骤、核心逻辑、功能定义 |
| **history** | **选择性合并**：核心流程图、核心组件列表 |

### ✅ spec 内容必须完整保留

- 核心需求描述
- **执行步骤**（定位组件、理解上下文、实现逻辑等）
- **核心逻辑**（过滤规则、匹配条件、业务规则等）
- 验收标准
- 注意事项

### ✅ history 内容选择性保留

- 核心流程图
- 核心组件列表
- 有价值的实现思路和分析

### ❌ history 中需删除的冗余内容

| 冗余内容 | 说明 |
|----------|------|
| 早期接口对接历史记录 | 已过时的 API 调用记录 |
| 重复的参数说明 | 与 spec 重复的内容 |
| 过时的代码示例 | 不再适用的旧代码 |
| 不再使用的配置说明 | 已废弃的配置项 |

### 🔒 文件处理规则

| 文件 | 处理方式 |
|------|----------|
| **spec 目录文档** | **保持不变**，不删除不修改 |
| **旧 history 文档** | **删除/替换**，被新合并文档取代 |

### 合并后文档结构

```markdown
# [功能名称]

## 核心需求（完整来自 spec）
[spec 中的需求描述]

## 执行步骤（完整来自 spec）
[spec 中的执行步骤，如定位组件、理解上下文等]

## 核心逻辑（完整来自 spec）
[spec 中的核心逻辑，如过滤规则、匹配条件等]

## 核心流程图（来自 history）
[history 中的流程图]

## 核心组件列表（来自 history）
[history 中的组件列表]

## 实现思路（合并两个文档）
[两个文档中有价值的分析]

## 更新记录
- [YYYY-MM-DD] 初始版本
- [YYYY-MM-DD] [变更说明]
```

---

## 更新 History 文档

### 🔒 重要：spec 文档保持不变

**⚠️ 强制要求：合并过程中，spec 目录下的文档必须保持不变，不删除不修改**

### 检查 history 目录

检查 `.cursor/commands/k/history/` 目录是否有相关文档。

### 情况 A：已有相关文档 → 替换旧 history

如果 history 目录中**已有**与本次需求相关的文档：

```
📄 检测到已有 History 文档：[文档名称]
🗑️ 删除旧 History 文档
📝 创建新的合并文档...
✅ spec 目录文档保持不变
```

**处理步骤**：
1. **读取 spec**：完整读取 spec 目录下的文档内容
2. **读取旧 history**：提取有价值的流程图和组件列表
3. **删除旧 history**：移除旧的 history 文档
4. **创建合并文档**：按照合并文档结构创建新文档
5. **保持 spec 不变**：spec 目录下的文档不做任何修改

### 情况 B：没有相关文档 → 新建合并文档

如果 history 目录中**没有**相关文档：

```
📄 未检测到 History 文档
📝 创建新的合并文档...
✅ spec 目录文档保持不变
```

**处理步骤**：
1. **读取 spec**：完整读取 spec 目录下的文档内容
2. **创建合并文档**：按照合并文档结构创建新文档
3. **保持 spec 不变**：spec 目录下的文档不做任何修改

- 命名格式：`YYYYMMDD-feature-description.md`（全英文，功能描述限5个单词）
- 内容：完整的 spec 内容 + 本次实现的流程图和核心组件列表

---

## 📊 流程图模板规范

**⚠️ 强制要求：编写 history 文档的流程图时，必须参考 `.cursor/commands/k/docs/history-flow-template.md`**

根据需求场景，选择最匹配的流程图模板：

| 模板 | 适用场景 | 说明 |
|------|----------|------|
| **模板 A** | 用户操作触发流程 | 用户主动操作后触发数据和 UI 变化的流程 |
| **模板 B** | 数据依赖流程 | 数据来源、依赖关系以及过滤逻辑的流程 |
| **模板 C** | 数据展示流程 | 从数据获取到 UI 显示的完整流程 |

### 选择规则

1. **用户交互类需求** → 优先使用模板 A
   - 如：点击按钮、表单提交、弹窗操作等

2. **数据流/状态管理类需求** → 优先使用模板 B
   - 如：数据源切换、状态同步、响应式更新等

3. **页面加载/数据展示类需求** → 优先使用模板 C
   - 如：列表加载、详情展示、API 调用等

4. **复杂需求** → 可组合使用多个模板

### 流程图编写要求

- 使用 ASCII 字符绘制（参考模板格式）
- 包含关键代码位置（文件名 + 行号）
- 标注状态变化和数据流向
- 中文注释说明每个步骤

### ✂️ 文字精简原则

**⚠️ 强制要求：history 文档只记录核心信息，避免冗长**

| ❌ 避免 | ✅ 推荐 |
|--------|--------|
| 详细描述每个实现细节 | 只写关键步骤和核心逻辑 |
| 大段解释性文字 | 用流程图 + 简短注释 |
| 重复说明已有信息 | 直接引用或跳过 |
| 复制粘贴完整代码 | 只标注文件名 + 行号 |

**文字要求**：
- 每个步骤描述 ≤ 30 字
- 变更说明 ≤ 3 条要点
- 优先用流程图表达，减少纯文字

---

## 完成输出

```
✅ 检查完成

📊 检查结果：[通过/未通过]
📝 问题数量：[N] 个
📁 History 文档：[已更新/已新建/跳过]

🎉 流程完成！可以提交代码。
```

---

## 🏁 流程结束

**本次开发流程全部完成。**

如需开始新的需求，请执行 `/k/spec [需求描述]`
