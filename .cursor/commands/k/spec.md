---
description: 理解需求背景并生成功能规范
handoffs: 
  - label: 🚀 进入计划阶段
    agent: k.plan
    prompt: 基于规范创建实现计划
    send: true
scripts:
  sh: scripts/check-prerequisites.sh --json
---

# 功能规范: [功能名称]

## 用户输入

```text
$ARGUMENTS
```

---

## 核心目的

a. 理解需求背景（**优先级：spec 目录文档 > prompt 文字**）
b. 理解项目背景上下文
c. 如果 `.cursor/commands/k/history/` 目录有文档，则阅读文档，理解之前的需求背景和实现
d. 理解项目实现的预期
e. 单一目的，确保没有多余的改动

---

## 执行步骤

### 1. 检测需求来源

**优先级判断**（按顺序检查）：

```
┌─────────────────────────────────────────────────────────┐
│ Step 1: 检查 spec 目录是否有文档                        │
│         (specs/ 或用户指定的目标目录)                      │
├─────────────────────────────────────────────────────────┤
│ 有文档 → 📄 读取 spec 目录下的 spec.md 或 *.md 文件     │
│ 无文档 → 继续 Step 2                                     │
├─────────────────────────────────────────────────────────┤
│ Step 2: 使用 $ARGUMENTS (prompt 文字)                    │
│         解析用户在命令中输入的需求描述                      │
└─────────────────────────────────────────────────────────┘
```

### 2. 获取需求内容

**情况 A：spec 目录有文档**
- 读取 `specs/[功能目录]/spec.md` 或相关文档
- 提取需求描述、用户故事、验收标准
- 输出：`📄 需求来源：spec 目录文档`

**情况 B：使用 prompt 文字**
- 解析 `$ARGUMENTS` 中的需求描述
- 输出：`📝 需求来源：prompt 输入`

### 3. 理解项目上下文

- 分析当前代码库结构和技术栈
- 识别相关模块和依赖

### 4. 查阅历史记录

- 读取 `history/` 目录下的相关文档
- 理解之前的需求背景和实现

### 5. 明确需求边界

- 确定本次改动的范围
- 排除不必要的修改

### 6. 需求清晰度检查

> 💡 **借鉴 Sora 团队经验**：明确的指令才能获得高质量输出

在进入下一阶段前，确保需求满足以下清晰度标准：

| 检查项 | 标准 | 状态 |
|--------|------|------|
| **目标明确** | 能用一句话说清楚要做什么 | ☐ |
| **边界清晰** | 明确包含什么、不包含什么 | ☐ |
| **可验证** | 有明确的完成标准 | ☐ |
| **无歧义** | 不存在多种理解方式 | ☐ |

**如果任一项不满足**：
- 主动向用户提问澄清
- 列出具体的疑问点
- 等待用户回复后再继续

---

## 完成条件

完成上述所有步骤后，输出：

```
✅ 规范理解完成

📄 需求来源：[spec 目录文档 / prompt 输入]
📋 需求摘要：[一句话描述需求]
📁 影响范围：[列出可能涉及的文件/模块]
⚠️ 注意事项：[如有特殊注意点]
```

---

## ⚡ 自动流转

**需求理解完成后，自动进入计划阶段。**

立即执行 `.cursor/commands/k/plan.md` 制定实现计划。
