# K 工作流 (自动化版)

轻量级规范驱动开发工作流，支持 Cursor Commands 自动流转。

---

## 📁 目录结构

```
.cursor/commands/k/
├── spec.md              # 需求规范 (入口) → /k/spec
├── plan.md              # 实现计划       → /k/plan
├── task.md              # 任务执行       → /k/task
├── check.md             # 检查验收       → /k/check
├── research.md          # 技术研究       → /k/research
├── spec/                # 📄 需求文档目录 (spec.md 优先读取)
├── history/             # 历史文档归档
├── rules/               # 项目规则
│   ├── regular.mdc      # 通用规范（始终应用）
│   ├── clean-code.mdc
│   └── react.mdc
└── scripts/
    └── check-prerequisites.sh
```

---

## 📄 Spec 目录说明

`spec/` 目录用于存放需求文档，`spec.md` 会**优先读取**该目录下的文件：

```
spec/
├── spec.md          # 主需求文档 (优先)
├── requirements.md  # 详细需求
└── *.md             # 其他相关文档
```

**优先级**：`spec/` 目录文档 > prompt 输入

---

## 🔄 工作流程

```
┌─────────┐    自动     ┌─────────┐    确认     ┌─────────┐    确认     ┌─────────┐
│  spec   │ ────────▶  │  plan   │ ────────▶  │  task   │ ────────▶  │  check  │
│ (理解)  │            │ (计划)  │   询问      │ (执行)  │   询问      │ (验收)  │
└─────────┘            └─────────┘            └─────────┘            └─────────┘
                                                                          │
                                                                          ▼
                                                                    ┌─────────┐
                                                                    │ history │
                                                                    │ (归档)  │
                                                                    └─────────┘
```

### 流转规则

| 阶段 | 流转方式 | 说明 |
|------|----------|------|
| spec → plan | ⚡ 自动 | 需求理解完成后自动进入计划阶段 |
| plan → task | 🔄 询问确认 | 方案确定后需用户确认才执行 |
| task → check | 🔄 询问确认 | 任务完成后需用户确认才进入检查 |
| check → history | ⚡ 自动 | 有文档则增量更新，无则自动新建 |

---

## 🚀 快速开始

```bash
# 方式1: 直接输入需求
/k/spec [你的需求描述]

# 方式2: 使用 spec 目录文档
# 1. 将需求文档放入 .cursor/commands/k/spec/ 目录
# 2. 执行 /k/spec
```

### 命令列表

| 命令 | 说明 |
|------|------|
| `/k/spec` | 开始新需求 |
| `/k/plan` | 单独执行计划阶段 |
| `/k/task` | 单独执行任务阶段 |
| `/k/check` | 单独执行检查阶段 |
| `/k/research` | 技术研究（辅助命令） |

---

## 📋 各阶段说明

### 1. Spec (需求规范)

- **优先读取** `spec/` 目录下的文档
- 理解需求背景
- 分析项目上下文
- 查阅历史文档
- 明确改动边界

### 2. Plan (实现计划)

- 确认技术方案
- 定位代码位置
- 拆分执行步骤
- 评估风险

### 3. Task (任务执行)

- 按步骤执行代码修改
- 遵循项目规范 (rules/)
- 追踪执行进度

### 4. Check (检查验收)

- 需求检查（4项）
- 技术检查（5项）
- AI代码审查（5项）
- 交付检查（3项）
- 自动更新 History 文档

---

## 📚 History 文档策略

| 情况 | 处理方式 |
|------|----------|
| 有相关文档 | 📝 **增量更新** - 追加新记录，保留原有内容 |
| 无相关文档 | 📄 **自动新建** - 创建新文档记录 |

**增量更新规则**：
- 尽量保留原有内容，优先在原有基础上修改
- 按需新增内容
- 核心流程图如有必要可以更新
- 绝对不完全覆盖/完全移除已有内容

---

## ⚙️ 特点

- ✅ **简短命令**: `/k/spec` 代替 `/kit/spec`
- ✅ **自动化**: Cursor Commands 自动流转
- ✅ **可控**: 关键节点（plan、task 确认）需用户确认
- ✅ **规范**: 集成项目代码规范 + AI 代码审查
- ✅ **归档**: 自动增量维护历史文档
- ✅ **文档优先**: 支持 `spec/` 目录文档作为需求来源
